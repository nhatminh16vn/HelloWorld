<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI√äU GAME B·∫ÆT B√ìNG PRO MAX</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Roboto:wght@400;700&display=swap');
        
        :root {
            --primary: #6C5CE7;
            --secondary: #00CEFF;
            --danger: #FF5252;
            --success: #00E676;
            --warning: #FFD600;
            --dark: #2D3436;
            --light: #F5F6FA;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            background: linear-gradient(to right, #00CEFF, #6C5CE7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(108, 92, 231, 0.3);
            margin-bottom: 0.5rem;
        }
        
        .game-container {
            position: relative;
            width: 800px;
            height: 600px;
            margin: 20px auto;
            box-shadow: 0 0 30px rgba(0, 206, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #gameCanvas {
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .game-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            pointer-events: none;
        }
        
        .score-container, .time-container, .level-container {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }
        
        .score-container {
            border: 2px solid var(--success);
        }
        
        .time-container {
            border: 2px solid var(--warning);
        }
        
        .level-container {
            border: 2px solid var(--secondary);
        }
        
        .icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .value {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            transition: all 0.3s ease;
        }
        
        .menu.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .menu-title {
            font-size: 4rem;
            margin-bottom: 2rem;
            background: linear-gradient(to right, #00CEFF, #6C5CE7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(108, 92, 231, 0.5);
        }
        
        .btn {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(108, 92, 231, 0.5);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(108, 92, 231, 0.8);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--danger), #FF8A80);
        }
        
        .btn-warning {
            background: linear-gradient(to right, var(--warning), #FFEA00);
        }
        
        .difficulty-buttons {
            display: flex;
            margin: 20px 0;
        }
        
        .powerup-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--success);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .powerup-indicator.active {
            opacity: 1;
        }
        
        .combo-meter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 10px currentColor;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .combo-meter.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        @media (max-width: 850px) {
            .game-container {
                width: 95vw;
                height: 80vh;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .menu-title {
                font-size: 2.5rem;
            }
            
            .btn {
                padding: 12px 30px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <h1>SI√äU GAME B·∫ÆT B√ìNG PRO MAX</h1>
    
    <div class="game-container">
        <div class="particles" id="particles"></div>
        
        <div class="game-ui">
            <div class="score-container">
                <span class="icon">üèÜ</span>
                <span class="value" id="score">0</span>
            </div>
            
            <div class="time-container">
                <span class="icon">‚è±Ô∏è</span>
                <span class="value" id="time">60</span>
            </div>
            
            <div class="level-container">
                <span class="icon">üöÄ</span>
                <span class="value" id="level">1</span>
            </div>
        </div>
        
        <div class="powerup-indicator" id="powerupIndicator">
            <span class="icon">‚ú®</span>
            <span id="powerupText">Power-up Active!</span>
        </div>
        
        <div class="combo-meter" id="comboMeter"></div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="menu" id="mainMenu">
            <h2 class="menu-title">B·∫ÆT B√ìNG PRO MAX</h2>
            
            <div class="difficulty-buttons">
                <button class="btn" onclick="startGame('easy')">D·ªÖ</button>
                <button class="btn btn-warning" onclick="startGame('medium')">Trung B√¨nh</button>
                <button class="btn btn-danger" onclick="startGame('hard')">Kh√≥</button>
            </div>
            
            <button class="btn" onclick="showInstructions()">H∆∞·ªõng D·∫´n</button>
            <button class="btn" onclick="showPowerups()">Power-ups</button>
        </div>
        
        <div class="menu hidden" id="instructionsMenu">
            <h2 class="menu-title">H∆Ø·ªöNG D·∫™N</h2>
            <div style="max-width: 600px; text-align: center; margin-bottom: 30px;">
                <p>Di chuy·ªÉn chu·ªôt ho·∫∑c d√πng ph√≠m m≈©i t√™n ƒë·ªÉ ƒëi·ªÅu khi·ªÉn gi·ªè b·∫Øt b√≥ng.</p>
                <p>B·∫Øt c√†ng nhi·ªÅu b√≥ng c√†ng t·ªët ƒë·ªÉ ghi ƒëi·ªÉm!</p>
                <p>C√°c lo·∫°i b√≥ng ƒë·∫∑c bi·ªát s·∫Ω cho b·∫°n power-up ho·∫∑c ƒëi·ªÉm bonus.</p>
                <p>Tr√°nh c√°c qu·∫£ bom - ch√∫ng s·∫Ω k·∫øt th√∫c tr√≤ ch∆°i!</p>
                <p>M·ªói level s·∫Ω kh√≥ h∆°n v·ªõi t·ªëc ƒë·ªô nhanh h∆°n v√† nhi·ªÅu ch∆∞·ªõng ng·∫°i v·∫≠t h∆°n.</p>
            </div>
            <button class="btn" onclick="showMainMenu()">Quay L·∫°i</button>
        </div>
        
        <div class="menu hidden" id="powerupsMenu">
            <h2 class="menu-title">POWER-UPS</h2>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
                <div style="text-align: center;">
                    <div style="width: 60px; height: 60px; background: linear-gradient(to bottom, #00E676, #00B248); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">2X</div>
                    <p>Nh√¢n ƒë√¥i ƒëi·ªÉm trong 10 gi√¢y</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 60px; height: 60px; background: linear-gradient(to bottom, #00CEFF, #0091EA); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">SLOW</div>
                    <p>L√†m ch·∫≠m b√≥ng trong 8 gi√¢y</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 60px; height: 60px; background: linear-gradient(to bottom, #FFD600, #FFAB00); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">BIG</div>
                    <p>M·ªü r·ªông gi·ªè trong 12 gi√¢y</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 60px; height: 60px; background: linear-gradient(to bottom, #FF5252, #D50000); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üí£</div>
                    <p>BOM - Tr√°nh xa!</p>
                </div>
            </div>
            <button class="btn" onclick="showMainMenu()">Quay L·∫°i</button>
        </div>
        
        <div class="menu hidden" id="gameOverMenu">
            <h2 class="menu-title">GAME OVER</h2>
            <h3 id="finalScore" style="margin-bottom: 30px; font-size: 2rem;">ƒêi·ªÉm: 0</h3>
            <button class="btn" onclick="startGame()">Ch∆°i L·∫°i</button>
            <button class="btn" onclick="showMainMenu()">Menu Ch√≠nh</button>
        </div>
    </div>

    <audio id="catchSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" preload="auto"></audio>
    <audio id="powerupSound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" preload="auto"></audio>
    <audio id="bombSound" src="https://assets.mixkit.co/sfx/preview/mixkit-explosion-impact-1684.mp3" preload="auto"></audio>
    <audio id="comboSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>
    <audio id="bgMusic" loop src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-668.mp3" preload="auto"></audio>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        // Kh·ªüi t·∫°o game
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const timeElement = document.getElementById('time');
        const levelElement = document.getElementById('level');
        const powerupIndicator = document.getElementById('powerupIndicator');
        const powerupText = document.getElementById('powerupText');
        const comboMeter = document.getElementById('comboMeter');
        
        // Menu elements
        const mainMenu = document.getElementById('mainMenu');
        const instructionsMenu = document.getElementById('instructionsMenu');
        const powerupsMenu = document.getElementById('powerupsMenu');
        const gameOverMenu = document.getElementById('gameOverMenu');
        const finalScoreElement = document.getElementById('finalScore');
        
        // √Çm thanh
        const catchSound = document.getElementById('catchSound');
        const powerupSound = document.getElementById('powerupSound');
        const bombSound = document.getElementById('bombSound');
        const comboSound = document.getElementById('comboSound');
        const bgMusic = document.getElementById('bgMusic');
        
        // C√°c bi·∫øn game
        let gameRunning = false;
        let animationId;
        let score = 0;
        let timeLeft = 60;
        let level = 1;
        let combo = 0;
        let lastComboTime = 0;
        let difficulty = 'medium';
        
        // Gi·ªè b·∫Øt b√≥ng
        const basket = {
            width: 120,
            height: 25,
            x: canvas.width / 2 - 60,
            color: '#6C5CE7',
            speed: 10
        };
        
        // C√°c lo·∫°i b√≥ng
        const BALL_TYPES = {
            NORMAL: { color: '#00CEFF', score: 1, radius: 15 },
            GOLD: { color: '#FFD600', score: 5, radius: 18 },
            DOUBLE: { color: '#00E676', score: 2, radius: 15, powerup: 'double' },
            SLOW: { color: '#00B0FF', score: 1, radius: 15, powerup: 'slow' },
            BIG: { color: '#FF6D00', score: 1, radius: 15, powerup: 'big' },
            BOMB: { color: '#FF5252', score: -10, radius: 20 }
        };
        
        let balls = [];
        let powerups = {
            double: { active: false, endTime: 0 },
            slow: { active: false, endTime: 0 },
            big: { active: false, endTime: 0 }
        };
        
        // T·∫°o hi·ªáu ·ª©ng particles
        particlesJS('particles', {
            particles: {
                number: { value: 50, density: { enable: true, value_area: 800 } },
                color: { value: "#00CEFF" },
                shape: { type: "circle" },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: { enable: true, distance: 150, color: "#6C5CE7", opacity: 0.4, width: 1 },
                move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" }
                }
            }
        });
        
        // H√†m hi·ªÉn th·ªã menu ch√≠nh
        function showMainMenu() {
            mainMenu.classList.remove('hidden');
            instructionsMenu.classList.add('hidden');
            powerupsMenu.classList.add('hidden');
            gameOverMenu.classList.add('hidden');
            stopGame();
        }
        
        // H√†m hi·ªÉn th·ªã h∆∞·ªõng d·∫´n
        function showInstructions() {
            mainMenu.classList.add('hidden');
            instructionsMenu.classList.remove('hidden');
            powerupsMenu.classList.add('hidden');
            gameOverMenu.classList.add('hidden');
        }
        
        // H√†m hi·ªÉn th·ªã powerups
        function showPowerups() {
            mainMenu.classList.add('hidden');
            instructionsMenu.classList.add('hidden');
            powerupsMenu.classList.remove('hidden');
            gameOverMenu.classList.add('hidden');
        }
        
        // H√†m hi·ªÉn th·ªã game over
        function showGameOver() {
            gameOverMenu.classList.remove('hidden');
            finalScoreElement.textContent = `ƒêi·ªÉm: ${score}`;
        }
        
        // H√†m b·∫Øt ƒë·∫ßu game
        function startGame(diff) {
            if (diff) difficulty = diff;
            
            mainMenu.classList.add('hidden');
            gameOverMenu.classList.add('hidden');
            
            // Reset game state
            score = 0;
            timeLeft = 60;
            level = 1;
            combo = 0;
            balls = [];
            
            // Reset powerups
            for (let p in powerups) {
                powerups[p].active = false;
            }
            
            // Reset basket
            basket.width = 120;
            basket.x = canvas.width / 2 - basket.width / 2;
            
            // Update UI
            scoreElement.textContent = score;
            timeElement.textContent = timeLeft;
            levelElement.textContent = level;
            
            // B·∫Øt ƒë·∫ßu game loop
            gameRunning = true;
            
            // B·∫Øt ƒë·∫ßu √¢m nh·∫°c
            bgMusic.volume = 0.3;
            bgMusic.play();
            
            // B·∫Øt ƒë·∫ßu timer
            const timer = setInterval(() => {
                if (!gameRunning) {
                    clearInterval(timer);
                    return;
                }
                
                timeLeft--;
                timeElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame();
                    clearInterval(timer);
                }
            }, 1000);
            
            // T·∫°o b√≥ng
            const ballInterval = setInterval(() => {
                if (!gameRunning) {
                    clearInterval(ballInterval);
                    return;
                }
                
                createBall();
            }, getBallInterval());
            
            gameLoop();
        }
        
        // H√†m t·∫°o b√≥ng
        function createBall() {
            const types = Object.keys(BALL_TYPES);
            let typeKey = types[0]; // M·∫∑c ƒë·ªãnh l√† b√≥ng th∆∞·ªùng
            
            // TƒÉng t·ªâ l·ªá b√≥ng ƒë·∫∑c bi·ªát theo level
            const specialBallChance = Math.min(0.1 + level * 0.02, 0.3);
            
            if (Math.random() < specialBallChance) {
                // Ch·ªçn ng·∫´u nhi√™n 1 trong c√°c lo·∫°i b√≥ng ƒë·∫∑c bi·ªát (tr·ª´ b√≥ng th∆∞·ªùng)
                const specialTypes = types.slice(1);
                typeKey = specialTypes[Math.floor(Math.random() * specialTypes.length)];
            }
            
            // Gi·∫£m t·ªâ l·ªá bom ·ªü level th·∫•p
            if (typeKey === 'BOMB' && level < 3 && Math.random() < 0.7) {
                typeKey = types[0];
            }
            
            const type = BALL_TYPES[typeKey];
            
            balls.push({
                x: Math.random() * (canvas.width - type.radius * 2) + type.radius,
                y: -type.radius,
                speed: getBallSpeed(),
                type: typeKey,
                radius: type.radius,
                color: type.color,
                score: type.score,
                powerup: type.powerup
            });
        }
        
        // H√†m l·∫•y t·ªëc ƒë·ªô b√≥ng theo ƒë·ªô kh√≥ v√† level
        function getBallSpeed() {
            let baseSpeed;
            
            switch(difficulty) {
                case 'easy':
                    baseSpeed = 2;
                    break;
                case 'hard':
                    baseSpeed = 4;
                    break;
                default: // medium
                    baseSpeed = 3;
            }
            
            return baseSpeed + level * 0.2;
        }
        
        // H√†m l·∫•y kho·∫£ng th·ªùi gian t·∫°o b√≥ng m·ªõi
        function getBallInterval() {
            let baseInterval;
            
            switch(difficulty) {
                case 'easy':
                    baseInterval = 1000;
                    break;
                case 'hard':
                    baseInterval = 500;
                    break;
                default: // medium
                    baseInterval = 800;
            }
            
            return Math.max(300, baseInterval - level * 50);
        }
        
        // Game loop ch√≠nh
        function gameLoop() {
            if (!gameRunning) return;
            
            // X√≥a canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // V·∫Ω n·ªÅn
            drawBackground();
            
            // V·∫Ω gi·ªè
            drawBasket();
            
            // C·∫≠p nh·∫≠t v√† v·∫Ω c√°c qu·∫£ b√≥ng
            updateBalls();
            
            // C·∫≠p nh·∫≠t powerups
            updatePowerups();
            
            // V·∫Ω combo n·∫øu ƒëang active
            if (Date.now() - lastComboTime < 1000 && combo > 2) {
                comboMeter.textContent = `COMBO x${combo}!`;
                comboMeter.style.color = getComboColor(combo);
                comboMeter.classList.add('active');
            } else {
                comboMeter.classList.remove('active');
            }
            
            animationId = requestAnimationFrame(gameLoop);
        }
        
        // V·∫Ω n·ªÅn
        function drawBackground() {
            // Gradient n·ªÅn
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(1, '#16213e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Hi·ªáu ·ª©ng sao
            ctx.fillStyle = 'white';
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const size = Math.random() * 2;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // V·∫Ω gi·ªè
        function drawBasket() {
            // Hi·ªáu ·ª©ng neon cho gi·ªè
            ctx.shadowColor = basket.color;
            ctx.shadowBlur = 15;
            
            // V·∫Ω gi·ªè
            ctx.fillStyle = basket.color;
            ctx.beginPath();
            ctx.moveTo(basket.x, canvas.height - basket.height - 10);
            ctx.lineTo(basket.x + basket.width, canvas.height - basket.height - 10);
            ctx.lineTo(basket.x + basket.width - 20, canvas.height - 10);
            ctx.lineTo(basket.x + 20, canvas.height - 10);
            ctx.closePath();
            ctx.fill();
            
            // T·∫Øt hi·ªáu ·ª©ng shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            
            // V·∫Ω vi·ªÅn gi·ªè
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        // C·∫≠p nh·∫≠t b√≥ng
        function updateBalls() {
            for (let i = 0; i < balls.length; i++) {
                const ball = balls[i];
                const type = BALL_TYPES[ball.type];
                
                // C·∫≠p nh·∫≠t v·ªã tr√≠
                let speed = ball.speed;
                if (powerups.slow.active) speed *= 0.5;
                
                ball.y += speed;
                
                // V·∫Ω b√≥ng
                drawBall(ball);
                
                // Ki·ªÉm tra va ch·∫°m v·ªõi gi·ªè
                if (checkBasketCollision(ball)) {
                    // X·ª≠ l√Ω va ch·∫°m
                    handleCollision(ball, i);
                    i--; // Gi·∫£m i do ƒë√£ x√≥a ph·∫ßn t·ª≠
                } 
                // Ki·ªÉm tra b√≥ng ra kh·ªèi m√†n h√¨nh
                else if (ball.y - ball.radius > canvas.height) {
                    // Reset combo n·∫øu b√≥ng th∆∞·ªùng r∆°i ra ngo√†i
                    if (ball.type === 'NORMAL') {
                        combo = 0;
                    }
                    
                    balls.splice(i, 1);
                    i--;
                }
            }
        }
        
        // V·∫Ω b√≥ng
        function drawBall(ball) {
            const type = BALL_TYPES[ball.type];
            
            // Hi·ªáu ·ª©ng glow cho b√≥ng ƒë·∫∑c bi·ªát
            if (ball.type !== 'NORMAL') {
                ctx.shadowColor = ball.color;
                ctx.shadowBlur = 15;
            }
            
            // V·∫Ω b√≥ng
            ctx.fillStyle = ball.color;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // T·∫Øt hi·ªáu ·ª©ng shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            
            // V·∫Ω chi ti·∫øt cho b√≥ng ƒë·∫∑c bi·ªát
            if (ball.type === 'GOLD') {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.beginPath();
                ctx.arc(ball.x - ball.radius * 0.3, ball.y - ball.radius * 0.3, ball.radius * 0.2, 0, Math.PI * 2);
                ctx.fill();
            } else if (ball.type === 'DOUBLE') {
                ctx.fillStyle = 'white';
                ctx.font = `bold ${ball.radius}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('2X', ball.x, ball.y);
            } else if (ball.type === 'SLOW') {
                ctx.fillStyle = 'white';
                ctx.font = `bold ${ball.radius}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('SLOW', ball.x, ball.y);
            } else if (ball.type === 'BIG') {
                ctx.fillStyle = 'white';
                ctx.font = `bold ${ball.radius}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('BIG', ball.x, ball.y);
            } else if (ball.type === 'BOMB') {
                // V·∫Ω ng√≤i bom
                ctx.fillStyle = '#FFD600';
                ctx.beginPath();
                ctx.moveTo(ball.x, ball.y - ball.radius);
                ctx.lineTo(ball.x + ball.radius * 0.5, ball.y - ball.radius * 1.2);
                ctx.lineTo(ball.x - ball.radius * 0.5, ball.y - ball.radius * 1.2);
                ctx.closePath();
                ctx.fill();
            }
        }
        
        // Ki·ªÉm tra va ch·∫°m v·ªõi gi·ªè
        function checkBasketCollision(ball) {
            // Ki·ªÉm tra va ch·∫°m ƒë∆°n gi·∫£n
            const basketTop = canvas.height - basket.height - 10;
            const basketBottom = canvas.height - 10;
            
            if (ball.y + ball.radius >= basketTop && ball.y - ball.radius <= basketBottom) {
                // Ki·ªÉm tra va ch·∫°m theo chi·ªÅu ngang
                if (ball.x >= basket.x && ball.x <= basket.x + basket.width) {
                    return true;
                }
                
                // Ki·ªÉm tra va ch·∫°m v·ªõi ph·∫ßn g√≥c nghi√™ng c·ªßa gi·ªè
                const leftEdge = basket.x + 20 * (1 - (ball.y + ball.radius - basketTop) / basket.height);
                const rightEdge = basket.x + basket.width - 20 * (1 - (ball.y + ball.radius - basketTop) / basket.height);
                
                if (ball.x >= leftEdge && ball.x <= rightEdge) {
                    return true;
                }
            }
            
            return false;
        }
        
        // X·ª≠ l√Ω va ch·∫°m
        function handleCollision(ball, index) {
            const type = BALL_TYPES[ball.type];
            
            // X·ª≠ l√Ω bom
            if (ball.type === 'BOMB') {
                bombSound.currentTime = 0;
                bombSound.play();
                endGame();
                return;
            }
            
            // Ph√°t √¢m thanh
            catchSound.currentTime = 0;
            catchSound.play();
            
            // T√≠nh ƒëi·ªÉm
            let points = type.score;
            if (powerups.double.active) points *= 2;
            
            score += points;
            scoreElement.textContent = score;
            
            // TƒÉng combo
            combo++;
            lastComboTime = Date.now();
            
            // Ph√°t √¢m thanh combo n·∫øu ƒë·ªß l·ªõn
            if (combo >= 5) {
                comboSound.currentTime = 0;
                comboSound.play();
            }
            
            // K√≠ch ho·∫°t powerup n·∫øu c√≥
            if (ball.powerup) {
                activatePowerup(ball.powerup);
            }
            
            // X√≥a b√≥ng
            balls.splice(index, 1);
            
            // Ki·ªÉm tra l√™n level
            checkLevelUp();
        }
        
        // K√≠ch ho·∫°t powerup
        function activatePowerup(type) {
            powerupSound.currentTime = 0;
            powerupSound.play();
            
            let duration = 0;
            let text = '';
            
            switch(type) {
                case 'double':
                    powerups.double.active = true;
                    duration = 10000; // 10 gi√¢y
                    powerups.double.endTime = Date.now() + duration;
                    text = 'NH√ÇN ƒê√îI ƒêI·ªÇM!';
                    break;
                case 'slow':
                    powerups.slow.active = true;
                    duration = 8000; // 8 gi√¢y
                    powerups.slow.endTime = Date.now() + duration;
                    text = 'L√ÄM CH·∫¨M B√ìNG!';
                    break;
                case 'big':
                    powerups.big.active = true;
                    duration = 12000; // 12 gi√¢y
                    powerups.big.endTime = Date.now() + duration;
                    basket.width = 180; // TƒÉng k√≠ch th∆∞·ªõc gi·ªè
                    text = 'GI·ªé L·ªöN!';
                    break;
            }
            
            // Hi·ªÉn th·ªã indicator
            powerupText.textContent = text;
            powerupIndicator.style.borderColor = BALL_TYPES[ball.type].color;
            powerupIndicator.classList.add('active');
            
            // T·ª± ƒë·ªông t·∫Øt indicator sau 2 gi√¢y
            setTimeout(() => {
                powerupIndicator.classList.remove('active');
            }, 2000);
        }
        
        // C·∫≠p nh·∫≠t powerups
        function updatePowerups() {
            const now = Date.now();
            let powerupActive = false;
            
            for (let p in powerups) {
                if (powerups[p].active && now >= powerups[p].endTime) {
                    powerups[p].active = false;
                    
                    // Reset gi·ªè n·∫øu l√† powerup big
                    if (p === 'big') {
                        basket.width = 120;
                    }
                }
                
                if (powerups[p].active) powerupActive = true;
            }
            
            // Hi·ªÉn th·ªã powerup active tr√™n UI
            if (powerupActive) {
                let activePowerups = [];
                for (let p in powerups) {
                    if (powerups[p].active) {
                        activePowerups.push(p.toUpperCase());
                    }
                }
                
                powerupText.textContent = `POWERUPS: ${activePowerups.join(', ')}`;
                powerupIndicator.classList.add('active');
            } else {
                powerupIndicator.classList.remove('active');
            }
        }
        
        // Ki·ªÉm tra l√™n level
        function checkLevelUp() {
            const pointsNeeded = level * 20;
            
            if (score >= pointsNeeded) {
                level++;
                levelElement.textContent = level;
                
                // Th√™m th·ªùi gian khi l√™n level
                timeLeft += 10;
                timeElement.textContent = timeLeft;
                
                // Hi·ªáu ·ª©ng level up
                comboMeter.textContent = `LEVEL ${level}!`;
                comboMeter.style.color = '#6C5CE7';
                comboMeter.classList.add('active');
                
                setTimeout(() => {
                    comboMeter.classList.remove('active');
                }, 1000);
            }
        }
        
        // H√†m k·∫øt th√∫c game
        function endGame() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            bgMusic.pause();
            showGameOver();
        }
        
        // H√†m d·ª´ng game
        function stopGame() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            bgMusic.pause();
        }
        
        // H√†m l·∫•y m√†u combo
        function getComboColor(combo) {
            if (combo < 5) return '#00CEFF';
            if (combo < 10) return '#00E676';
            if (combo < 15) return '#FFD600';
            return '#FF5252';
        }
        
        // S·ª± ki·ªán b√†n ph√≠m
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            const moveAmount = basket.speed;
            
            switch(e.key) {
                case 'ArrowLeft':
                    basket.x = Math.max(0, basket.x - moveAmount);
                    break;
                case 'ArrowRight':
                    basket.x = Math.min(canvas.width - basket.width, basket.x + moveAmount);
                    break;
            }
        });
        
        // S·ª± ki·ªán di chuy·ªÉn chu·ªôt
        canvas.addEventListener('mousemove', (e) => {
            if (!gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            basket.x = e.clientX - rect.left - basket.width / 2;
            
            // Gi·ªØ gi·ªè trong canvas
            basket.x = Math.max(0, Math.min(canvas.width - basket.width, basket.x));
        });
        
        // Touch events for mobile
        canvas.addEventListener('touchmove', (e) => {
            if (!gameRunning) return;
            e.preventDefault();
            
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            basket.x = touch.clientX - rect.left - basket.width / 2;
            
            // Gi·ªØ gi·ªè trong canvas
            basket.x = Math.max(0, Math.min(canvas.width - basket.width, basket.x));
        }, { passive: false });
    </script>
</body>
</html>
