<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Đuổi Bắt Nâng Cao - 1 Bot Ban Đầu</title>
<style>
  body {
    margin: 0; background: #111; color: #eee; font-family: Arial, sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;
  }
  #gameCanvas {
    background: linear-gradient(135deg, #222244, #111122);
    border: 3px solid #44aaff;
    border-radius: 10px;
    box-shadow: 0 0 20px #44aaffaa;
    display: block;
  }
  #info {
    margin-top: 15px;
    font-size: 20px;
    text-align: center;
  }
  #info span {
    font-weight: bold;
    color: #44aaff;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="600" height="400"></canvas>
<div id="info">
  Thời gian sống sót: <span id="timer">0.0</span> giây<br/>
  Điểm cao nhất: <span id="highscore">0.0</span> giây
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const player = {
  x: 50,
  y: 50,
  size: 30,
  speed: 5,
  color: 'cyan',
  shadowColor: 'rgba(0,255,255,0.6)',
};

const chasers = [
  { x: 500, y: 300, size: 30, baseSpeed: 2.5, speed: 2.5, color: 'red', shadowColor: 'rgba(255,0,0,0.6)', phase: 0 },
];

let keys = {};
let startTime = null;
let gameOver = false;
let highScore = parseFloat(localStorage.getItem('chaseHighScore')) || 0;
document.getElementById('highscore').textContent = highScore.toFixed(1);

let lastAddTime = 0;

window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
});
window.addEventListener('keyup', e => {
  keys[e.key.toLowerCase()] = false;
});

function movePlayer() {
  if (keys['w'] || keys['arrowup']) player.y -= player.speed;
  if (keys['s'] || keys['arrowdown']) player.y += player.speed;
  if (keys['a'] || keys['arrowleft']) player.x -= player.speed;
  if (keys['d'] || keys['arrowright']) player.x += player.speed;
  
  player.x = Math.max(0, Math.min(player.x, canvas.width - player.size));
  player.y = Math.max(0, Math.min(player.y, canvas.height - player.size));
}

function moveChaser(chaser, elapsed, index) {
  chaser.speed = chaser.baseSpeed + elapsed * 0.12;
  
  let speedMultiplier = 1 + 0.5 * Math.sin(elapsed + chaser.phase * 5);
  let currentSpeed = chaser.speed * speedMultiplier;
  
  let dx = player.x - chaser.x;
  let dy = player.y - chaser.y;
  let dist = Math.sqrt(dx*dx + dy*dy);

  if (dist > 0) {
    let avoidX = 0, avoidY = 0;
    const margin = 40;
    if (chaser.x < margin) avoidX = 1;
    else if (chaser.x > canvas.width - margin) avoidX = -1;
    if (chaser.y < margin) avoidY = 1;
    else if (chaser.y > canvas.height - margin) avoidY = -1;

    let adjX = dx / dist + avoidX * 0.5;
    let adjY = dy / dist + avoidY * 0.5;
    let adjLen = Math.sqrt(adjX*adjX + adjY*adjY);
    adjX /= adjLen;
    adjY /= adjLen;

    chaser.x += adjX * currentSpeed;
    chaser.y += adjY * currentSpeed;
  }
}

function checkCollision(obj1, obj2) {
  return !(obj1.x + obj1.size < obj2.x ||
           obj1.x > obj2.x + obj2.size ||
           obj1.y + obj1.size < obj2.y ||
           obj1.y > obj2.y + obj2.size);
}

function updateTimer() {
  if (!startTime) startTime = Date.now();
  let elapsed = (Date.now() - startTime) / 1000;
  document.getElementById('timer').textContent = elapsed.toFixed(1);
  return elapsed;
}

function drawRectWithShadow(obj) {
  ctx.shadowColor = obj.shadowColor;
  ctx.shadowBlur = 15;
  ctx.fillStyle = obj.color;
  ctx.fillRect(obj.x, obj.y, obj.size, obj.size);
  ctx.shadowBlur = 0;
}

function createNewChaser() {
  const size = 30;
  let x = Math.random() * (canvas.width - size);
  let y = Math.random() * (canvas.height - size);
  let baseSpeed = 1.5 + Math.random() * 1.5;
  const colors = [
    { color: 'red', shadowColor: 'rgba(255,0,0,0.6)' },
    { color: 'orange', shadowColor: 'rgba(255,165,0,0.6)' },
    { color: 'yellow', shadowColor: 'rgba(255,255,0,0.6)' },
    { color: 'lime', shadowColor: 'rgba(0,255,0,0.6)' },
    { color: 'cyan', shadowColor: 'rgba(0,255,255,0.6)' },
    { color: 'magenta', shadowColor: 'rgba(255,0,255,0.6)' },
  ];
  let c = colors[Math.floor(Math.random() * colors.length)];
  
  return { x, y, size, baseSpeed, speed: baseSpeed, color: c.color, shadowColor: c.shadowColor, phase: Math.random() * Math.PI * 2 };
}

function gameLoop() {
  if (gameOver) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#44aaff';
    ctx.font = '48px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Bạn đã bị bắt!', canvas.width / 2, canvas.height / 2 - 20);
    ctx.font = '24px Arial';
    ctx.fillText('Nhấn F5 để chơi lại', canvas.width / 2, canvas.height / 2 + 20);
    return;
  }
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  movePlayer();
  
  let elapsed = updateTimer();

  if (elapsed - lastAddTime >= 1) {
    chasers.push(createNewChaser());
    lastAddTime = elapsed;
  }

  for (let i = 0; i < chasers.length; i++) {
    moveChaser(chasers[i], elapsed, i);
    drawRectWithShadow(chasers[i]);
    
    if (checkCollision(player, chasers[i])) {
      gameOver = true;
      if (elapsed > highScore) {
        highScore = elapsed;
        localStorage.setItem('chaseHighScore', highScore.toFixed(1));
        document.getElementById('highscore').textContent = highScore.toFixed(1);
      }
    }
  }

  drawRectWithShadow(player);
  
  if (!gameOver) requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
