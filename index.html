<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Đuổi Bắt</title>
<style>
  body {
    margin: 0; background: #111; color: #eee; font-family: Arial, sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;
  }
  #gameCanvas {
    background: #222;
    border: 2px solid #555;
    display: block;
  }
  #info {
    margin-top: 10px;
    font-size: 20px;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<div id="info">Thời gian sống sót: <span id="timer">0.0</span> giây</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const player = {
  x: 50,
  y: 50,
  size: 30,
  speed: 5,
  color: 'cyan',
};

const chaser = {
  x: 500,
  y: 300,
  size: 30,
  speed: 2.5,
  color: 'red',
};

let keys = {};
let startTime = null;
let gameOver = false;

window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
});
window.addEventListener('keyup', e => {
  keys[e.key.toLowerCase()] = false;
});

function movePlayer() {
  if (keys['w'] || keys['arrowup']) player.y -= player.speed;
  if (keys['s'] || keys['arrowdown']) player.y += player.speed;
  if (keys['a'] || keys['arrowleft']) player.x -= player.speed;
  if (keys['d'] || keys['arrowright']) player.x += player.speed;
  
  // Giới hạn trong canvas
  if (player.x < 0) player.x = 0;
  if (player.y < 0) player.y = 0;
  if (player.x > canvas.width - player.size) player.x = canvas.width - player.size;
  if (player.y > canvas.height - player.size) player.y = canvas.height - player.size;
}

function moveChaser() {
  // Hướng về phía player
  let dx = player.x - chaser.x;
  let dy = player.y - chaser.y;
  let dist = Math.sqrt(dx*dx + dy*dy);
  if (dist > 0) {
    chaser.x += (dx / dist) * chaser.speed;
    chaser.y += (dy / dist) * chaser.speed;
  }
}

function checkCollision() {
  return !(player.x + player.size < chaser.x ||
           player.x > chaser.x + chaser.size ||
           player.y + player.size < chaser.y ||
           player.y > chaser.y + chaser.size);
}

function updateTimer() {
  if (!startTime) startTime = Date.now();
  let elapsed = (Date.now() - startTime) / 1000;
  document.getElementById('timer').textContent = elapsed.toFixed(1);
}

function drawRect(obj) {
  ctx.fillStyle = obj.color;
  ctx.fillRect(obj.x, obj.y, obj.size, obj.size);
}

function gameLoop() {
  if (gameOver) {
    ctx.fillStyle = 'white';
    ctx.font = '40px Arial';
    ctx.fillText('Bạn đã bị bắt!', canvas.width / 2 - 120, canvas.height / 2);
    return;
  }
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  movePlayer();
  moveChaser();
  drawRect(player);
  drawRect(chaser);
  
  if (checkCollision()) {
    gameOver = true;
  } else {
    updateTimer();
    requestAnimationFrame(gameLoop);
  }
}

gameLoop();
</script>
</body>
</html>
