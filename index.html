<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Bóng Đá 3D</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #87CEEB;
        }
        canvas { 
            display: block; 
        }
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 18px;
            text-shadow: 1px 1px 1px black;
        }
        #score {
            position: absolute;
            top: 40px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 24px;
            text-shadow: 1px 1px 1px black;
        }
    </style>
</head>
<body>
    <div id="info">Game Bóng Đá 3D - Dùng phím mũi tên để di chuyển, Space để sút bóng</div>
    <div id="score">Điểm: 0</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
    <script>
        // Khởi tạo scene, camera và renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Khởi tạo vật lý với Cannon.js
        const world = new CANNON.World();
        world.gravity.set(0, -9.82, 0);
        world.broadphase = new CANNON.NaiveBroadphase();
        world.solver.iterations = 10;

        // Tạo sân bóng
        const groundGeometry = new THREE.PlaneGeometry(30, 20);
        const groundMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x00AA00,
            side: THREE.DoubleSide
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Vật lý cho mặt đất
        const groundShape = new CANNON.Plane();
        const groundBody = new CANNON.Body({ mass: 0 });
        groundBody.addShape(groundShape);
        groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
        world.addBody(groundBody);

        // Tạo khung thành
        function createGoal(x, z) {
            const goalGeometry = new THREE.BoxGeometry(2, 2, 1);
            const goalMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF });
            const goal = new THREE.Mesh(goalGeometry, goalMaterial);
            goal.position.set(x, 1, z);
            goal.castShadow = true;
            scene.add(goal);
            
            // Vật lý cho khung thành
            const goalShape = new CANNON.Box(new CANNON.Vec3(1, 1, 0.5));
            const goalBody = new CANNON.Body({ mass: 0 });
            goalBody.addShape(goalShape);
            goalBody.position.set(x, 1, z);
            world.addBody(goalBody);
            
            return goal;
        }

        const goal1 = createGoal(-15, 0);
        const goal2 = createGoal(15, 0);

        // Tạo bóng
        const ballGeometry = new THREE.SphereGeometry(0.5, 32, 32);
        const ballMaterial = new THREE.MeshStandardMaterial({ 
            color: 0xFFFFFF,
            roughness: 0.1,
            metalness: 0.3
        });
        const ball = new THREE.Mesh(ballGeometry, ballMaterial);
        ball.position.set(0, 2, 0);
        ball.castShadow = true;
        scene.add(ball);

        // Vật lý cho bóng
        const ballShape = new CANNON.Sphere(0.5);
        const ballBody = new CANNON.Body({ mass: 0.5 });
        ballBody.addShape(ballShape);
        ballBody.position.set(0, 2, 0);
        ballBody.linearDamping = 0.4;
        ballBody.angularDamping = 0.4;
        world.addBody(ballBody);

        // Tạo cầu thủ
        const playerGeometry = new THREE.CylinderGeometry(0.5, 0.5, 1.8, 16);
        const playerMaterial = new THREE.MeshStandardMaterial({ color: 0x0000FF });
        const player = new THREE.Mesh(playerGeometry, playerMaterial);
        player.position.set(0, 0.9, 5);
        player.castShadow = true;
        scene.add(player);

        // Vật lý cho cầu thủ
        const playerShape = new CANNON.Cylinder(0.5, 0.5, 1.8, 16);
        const playerBody = new CANNON.Body({ mass: 5 });
        playerBody.addShape(playerShape);
        playerBody.position.set(0, 0.9, 5);
        playerBody.linearDamping = 0.5;
        playerBody.angularDamping = 0.5;
        world.addBody(playerBody);

        // Ánh sáng
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8);
        directionalLight.position.set(10, 20, 10);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        scene.add(directionalLight);

        // Đặt camera
        camera.position.set(0, 10, 15);
        camera.lookAt(0, 0, 0);

        // Điều khiển
        const keys = {};
        document.addEventListener('keydown', (event) => {
            keys[event.code] = true;
        });
        document.addEventListener('keyup', (event) => {
            keys[event.code] = false;
        });

        // Biến điểm
        let score = 0;
        const scoreElement = document.getElementById('score');

        // Vòng lặp game
        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            
            const delta = clock.getDelta();
            world.step(delta);
            
            // Cập nhật vị trí đồ họa từ vật lý
            ball.position.copy(ballBody.position);
            ball.quaternion.copy(ballBody.quaternion);
            
            player.position.copy(playerBody.position);
            player.quaternion.copy(playerBody.quaternion);
            
            // Điều khiển cầu thủ
            const force = 10;
            if (keys['ArrowUp']) {
                playerBody.velocity.z = -5;
            }
            if (keys['ArrowDown']) {
                playerBody.velocity.z = 5;
            }
            if (keys['ArrowLeft']) {
                playerBody.velocity.x = -5;
            }
            if (keys['ArrowRight']) {
                playerBody.velocity.x = 5;
            }
            if (keys['Space']) {
                // Sút bóng nếu gần bóng
                const distance = playerBody.position.distanceTo(ballBody.position);
                if (distance < 2) {
                    const direction = new CANNON.Vec3();
                    direction.copy(ballBody.position);
                    direction.vsub(playerBody.position, direction);
                    direction.normalize();
                    direction.scale(15, direction);
                    ballBody.velocity.copy(direction);
                }
            }
            
            // Kiểm tra ghi bàn
            if (ballBody.position.x < -14.5 && ballBody.position.z > -1 && ballBody.position.z < 1) {
                score++;
                scoreElement.textContent = `Điểm: ${score}`;
                resetBall();
            }
            
            renderer.render(scene, camera);
        }

        // Reset bóng về vị trí trung tâm
        function resetBall() {
            ballBody.position.set(0, 2, 0);
            ballBody.velocity.set(0, 0, 0);
            ballBody.angularVelocity.set(0, 0, 0);
        }

        // Xử lý thay đổi kích thước cửa sổ
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
